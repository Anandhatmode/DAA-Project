<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Minimum Cost Electricity Distribution — Kruskal's MST</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#9aa6b2;
      --glass: rgba(255,255,255,0.03);
      --success:#10b981; --danger:#ef4444;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071026 0%, #081026 60%); color:#e6eef6;}
    .wrap{max-width:1100px;margin:28px auto;padding:22px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow: 0 8px 30px rgba(2,6,23,0.7);}
    h1{margin:0 0 6px;font-size:20px;color:var(--accent);}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns: 420px 1fr;gap:20px;}
    .card{background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px;}
    input[type="number"], input[type="text"]{width:100%;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#e9f3fb;}
    .row{display:flex;gap:10px;align-items:center;}
    button{background:var(--accent);border:none;color:#052027;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer;}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);}
    .small{font-size:12px;padding:6px 8px;border-radius:6px}
    table{width:100%;border-collapse:collapse;margin-top:10px;color:#e8f3fb;font-size:13px;}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);}
    th{color:var(--muted);font-weight:600;font-size:12px;}
    .controls{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;}
    .vis-wrap{display:flex;flex-direction:column;height:640px;}
    svg{width:100%;height:520px;background:linear-gradient(180deg, rgba(6,10,15,0.6), rgba(6,10,25,0.2));border-radius:8px;border:1px solid rgba(255,255,255,0.03);}
    .info{margin-top:10px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center;}
    .chip{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.02);font-weight:600;}
    .mst-edge{color:var(--success);font-weight:700}
    .edge-btn{background:transparent;border:none;color:var(--muted);cursor:pointer}
    .danger{color:var(--danger)}
    footer{margin-top:14px;color:var(--muted);font-size:12px;text-align:center}
    @media (max-width:980px){ .grid{grid-template-columns: 1fr; } .vis-wrap{height:480px} svg{height:420px} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Minimum Cost Electricity Distribution — Kruskal's Algorithm</h1>
    <p class="lead">Interactive demonstration of Disjoint Set (Union-Find) + Kruskal's MST. Add edges, change nodes, compute MST and visualize the result.</p>

    <div class="grid">
      <!-- Left panel -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div>
            <label for="nodeCount">Number of Cities (nodes)</label>
            <input id="nodeCount" type="number" min="2" max="20" value="5" />
          </div>
          <div style="width:8px"></div>
          <div style="min-width:130px">
            <label>&nbsp;</label>
            <div class="row">
              <button id="applyNodes" class="small">Apply</button>
              <button id="resetBtn" class="small ghost">Reset</button>
            </div>
          </div>
        </div>

        <hr style="border:none;border-top:1px dashed rgba(255,255,255,0.03);margin:10px 0" />

        <label>Add Edge (u, v, cost)</label>
        <div class="row" style="margin-bottom:8px">
          <input id="uInput" type="number" min="0" placeholder="u (0-based)" />
          <input id="vInput" type="number" min="0" placeholder="v (0-based)" />
          <input id="wInput" type="number" min="0" placeholder="cost" />
          <button id="addEdge" class="small">Add</button>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <button id="compute" class="small">Compute MST</button>
          <button id="autoExample" class="small ghost">Load Example</button>
          <button id="exportBtn" class="small ghost">Export JSON</button>
        </div>

        <table id="edgesTable" aria-label="Edges table">
          <thead>
            <tr><th>u</th><th>v</th><th>cost</th><th></th></tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="info">
          <div class="chip">MST Cost: <span id="mstCost">—</span></div>
          <div style="text-align:right">
            <div style="font-size:13px;color:var(--muted)">MST Edges:</div>
            <div id="mstList" style="font-weight:600;margin-top:6px"></div>
          </div>
        </div>

        <footer>Nodes are 0-indexed (City0, City1, ...). Drag not required — positions auto-arranged.</footer>
      </div>

      <!-- Right panel: visualization -->
      <div class="card vis-wrap">
        <svg id="svgCanvas" viewBox="0 0 900 520" preserveAspectRatio="xMidYMid meet"></svg>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div style="color:var(--muted)">Click an edge row's ❌ to remove it. MST edges are highlighted in green.</div>
          <div>
            <button id="showAll" class="small ghost">Show All Edges</button>
            <button id="highlightMST" class="small">Highlight MST</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/*
  Single-file Kruskal + Visualization
  - DisjointSet class with path compression + union by rank
  - kruskalMST function
  - Visualization on SVG: nodes placed on a circle; edges as lines with weight labels
  - Interactive: add/remove edges, change node count, load example, export JSON
*/

class DisjointSet {
  constructor(n){
    this.parent = new Array(n);
    this.rank = new Array(n).fill(0);
    for(let i=0;i<n;i++) this.parent[i]=i;
  }
  find(x){
    if (this.parent[x] !== x) this.parent[x] = this.find(this.parent[x]);
    return this.parent[x];
  }
  union(x,y){
    let rx = this.find(x), ry = this.find(y);
    if (rx === ry) return false;
    if (this.rank[rx] < this.rank[ry]) this.parent[rx] = ry;
    else if (this.rank[rx] > this.rank[ry]) this.parent[ry] = rx;
    else { this.parent[ry] = rx; this.rank[rx]++; }
    return true;
  }
}

function kruskalMST(n, edges){
  // edges: array of [u,v,w, id]
  const ds = new DisjointSet(n);
  const sorted = edges.slice().sort((a,b)=>a[2]-b[2]);
  let mst = [], cost = 0;
  for(const e of sorted){
    const [u,v,w,id] = e;
    if (ds.union(u,v)){
      mst.push(e);
      cost += w;
    }
  }
  return { cost, mst };
}

/* App state */
let state = {
  n: 5,
  edges: [], // [u,v,w,id]
  nextEdgeId: 1,
  mstResult: null
};

/* DOM references */
const nodeCountInput = document.getElementById('nodeCount');
const applyNodesBtn = document.getElementById('applyNodes');
const resetBtn = document.getElementById('resetBtn');
const uInput = document.getElementById('uInput');
const vInput = document.getElementById('vInput');
const wInput = document.getElementById('wInput');
const addEdgeBtn = document.getElementById('addEdge');
const computeBtn = document.getElementById('compute');
const autoExampleBtn = document.getElementById('autoExample');
const edgesTableBody = document.querySelector('#edgesTable tbody');
const mstCostEl = document.getElementById('mstCost');
const mstListEl = document.getElementById('mstList');
const svgCanvas = document.getElementById('svgCanvas');
const exportBtn = document.getElementById('exportBtn');
const showAllBtn = document.getElementById('showAll');
const highlightMSTBtn = document.getElementById('highlightMST');

/* Utilities */
function clamp(val, a, b){ return Math.max(a, Math.min(b, val)); }

function addEdge(u,v,w){
  u = Number(u); v = Number(v); w = Number(w);
  if (!Number.isInteger(u) || !Number.isInteger(v) || !Number.isFinite(w)) {
    alert('Enter valid integers for u, v and a numeric cost w.');
    return;
  }
  if (u < 0 || v < 0 || u >= state.n || v >= state.n) {
    alert(`u and v must be between 0 and ${state.n-1}.`);
    return;
  }
  if (u === v){
    alert('No self-loop allowed (u !== v).');
    return;
  }
  // allow multiple edges (parallel)
  state.edges.push([u,v,w,state.nextEdgeId++]);
  renderEdgesTable();
  renderSVG();
}

function removeEdgeById(id){
  state.edges = state.edges.filter(e => e[3] !== id);
  renderEdgesTable();
  renderSVG();
}

function renderEdgesTable(){
  edgesTableBody.innerHTML = '';
  for(const e of state.edges){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>City${e[0]}</td><td>City${e[1]}</td><td>${e[2]}</td>
      <td style="text-align:right"><button class="edge-btn" data-id="${e[3]}">❌</button></td>`;
    edgesTableBody.appendChild(tr);
  }
  // attach delete handlers
  edgesTableBody.querySelectorAll('button.edge-btn').forEach(btn=>{
    btn.addEventListener('click', (ev)=>{
      const id = Number(ev.currentTarget.dataset.id);
      if (confirm('Remove this edge?')) removeEdgeById(id);
    });
  });
}

function computeMSTAndRender(){
  const res = kruskalMST(state.n, state.edges);
  state.mstResult = res;
  mstCostEl.textContent = res.mst ? '—' : res.cost; // fallback
  // show list
  if (res.mst && res.mst.length>0) {
    mstListEl.innerHTML = res.mst.map(e => `City${e[0]}–City${e[1]} (${e[2]})`).join(', ');
  } else if (res.mst && res.mst.length===0) {
    mstListEl.textContent = '—';
  } else {
    mstListEl.textContent = res.mst || '—';
  }
  // better: res returns {cost, mst}
  mstCostEl.textContent = res.cost;
  mstListEl.innerHTML = res.mst.map(e => `<span class="mst-edge">City${e[0]}–City${e[1]} (${e[2]})</span>`).join(', ');
  renderSVG(true);
}

/* SVG rendering */
function nodePositions(n, width=900, height=520){
  // place nodes on a circle centered in the viewbox
  const cx = width/2, cy = height/2 - 10;
  const r = Math.min(width, height)/2 - 90;
  const pts = [];
  for(let i=0;i<n;i++){
    const ang = (2*Math.PI*i)/n - Math.PI/2;
    const x = cx + r*Math.cos(ang);
    const y = cy + r*Math.sin(ang);
    pts.push({x,y});
  }
  return pts;
}

function renderSVG(highlightMST=false){
  // clear
  while(svgCanvas.firstChild) svgCanvas.removeChild(svgCanvas.firstChild);

  const width = 900, height = 520;
  const pts = nodePositions(state.n,width,height);
  // draw non-MST edges first (light)
  const mstIds = new Set((state.mstResult && state.mstResult.mst) ? state.mstResult.mst.map(e=>e[3]) : []);
  // lines: draw non-MST edges in subtle color first
  state.edges.forEach(e=>{
    const [u,v,w,id] = e;
    const p1 = pts[u], p2 = pts[v];
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',p1.x); line.setAttribute('y1',p1.y);
    line.setAttribute('x2',p2.x); line.setAttribute('y2',p2.y);
    line.setAttribute('stroke-width', mstIds.has(id) ? 4 : 2);
    line.setAttribute('stroke-linecap','round');
    line.setAttribute('stroke', mstIds.has(id) ? 'url(#gradMST)' : 'rgba(255,255,255,0.07)');
    line.setAttribute('data-edge-id', id);
    line.style.transition = 'stroke 300ms, stroke-width 300ms';
    svgCanvas.appendChild(line);

    // weight label at midpoint
    const mx = (p1.x+p2.x)/2, my = (p1.y+p2.y)/2;
    const circle = document.createElementNS('http://www.w3.org/2000/svg','rect');
    circle.setAttribute('x', mx-16); circle.setAttribute('y', my-12);
    circle.setAttribute('width', 34); circle.setAttribute('height', 20);
    circle.setAttribute('rx', 8); circle.setAttribute('ry', 8);
    circle.setAttribute('fill', mstIds.has(id) ? 'rgba(16,185,129,0.14)' : 'rgba(255,255,255,0.03)');
    circle.setAttribute('stroke', mstIds.has(id) ? 'rgba(16,185,129,0.22)' : 'rgba(255,255,255,0.02)');
    svgCanvas.appendChild(circle);

    const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
    txt.setAttribute('x', mx); txt.setAttribute('y', my+4);
    txt.setAttribute('text-anchor','middle');
    txt.setAttribute('font-size','12');
    txt.setAttribute('fill', mstIds.has(id) ? '#10b981' : '#cfe9ff');
    txt.textContent = w;
    svgCanvas.appendChild(txt);
  });

  // defs for gradient
  const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
  const grad = document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
  grad.setAttribute('id','gradMST'); grad.setAttribute('x1','0%'); grad.setAttribute('x2','100%');
  const stop1 = document.createElementNS('http://www.w3.org/2000/svg','stop'); stop1.setAttribute('offset','0%'); stop1.setAttribute('stop-color','#06b6d4');
  const stop2 = document.createElementNS('http://www.w3.org/2000/svg','stop'); stop2.setAttribute('offset','100%'); stop2.setAttribute('stop-color','#10b981');
  grad.appendChild(stop1); grad.appendChild(stop2); defs.appendChild(grad);
  svgCanvas.appendChild(defs);

  // draw nodes on top
  pts.forEach((p,i)=>{
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    const circ = document.createElementNS('http://www.w3.org/2000/svg','circle');
    circ.setAttribute('cx',p.x); circ.setAttribute('cy',p.y); circ.setAttribute('r',20);
    circ.setAttribute('fill','rgba(255,255,255,0.03)');
    circ.setAttribute('stroke','rgba(255,255,255,0.06)');
    circ.setAttribute('stroke-width','1.2');
    g.appendChild(circ);
    const labelBg = document.createElementNS('http://www.w3.org/2000/svg','rect');
    labelBg.setAttribute('x', p.x-28); labelBg.setAttribute('y', p.y+24);
    labelBg.setAttribute('width', 56); labelBg.setAttribute('height',20);
    labelBg.setAttribute('rx',10); labelBg.setAttribute('ry',10);
    labelBg.setAttribute('fill','rgba(3,7,12,0.5)');
    labelBg.setAttribute('stroke','rgba(255,255,255,0.02)');
    g.appendChild(labelBg);
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('x',p.x); label.setAttribute('y',p.y+39);
    label.setAttribute('text-anchor','middle'); label.setAttribute('font-size','12'); label.setAttribute('fill','#dff6ff');
    label.textContent = 'City'+i;
    g.appendChild(label);
    svgCanvas.appendChild(g);
  });

  // subtle overlay text if no edges
  if (state.edges.length === 0){
    const hint = document.createElementNS('http://www.w3.org/2000/svg','text');
    hint.setAttribute('x',450); hint.setAttribute('y',260);
    hint.setAttribute('text-anchor','middle'); hint.setAttribute('font-size','14'); hint.setAttribute('fill','rgba(255,255,255,0.06)');
    hint.textContent = 'No edges — add edges to compute MST';
    svgCanvas.appendChild(hint);
  }
}

/* Interaction handlers */
applyNodesBtn.addEventListener('click', ()=>{
  const n = clamp(Number(nodeCountInput.value), 2, 20);
  state.n = n;
  state.edges = []; state.nextEdgeId = 1; state.mstResult = null;
  renderEdgesTable(); renderSVG();
  mstCostEl.textContent = '—'; mstListEl.textContent = '—';
});

resetBtn.addEventListener('click', ()=>{
  if (!confirm('Reset nodes and edges to default example?')) return;
  loadExample();
});

addEdgeBtn.addEventListener('click', ()=>{
  addEdge(uInput.value, vInput.value, wInput.value);
  uInput.value = vInput.value = wInput.value = '';
});

computeBtn.addEventListener('click', ()=>{
  computeMSTAndRender();
});

autoExampleBtn.addEventListener('click', ()=>{
  loadExample();
});

exportBtn.addEventListener('click', ()=>{
  const payload = { n: state.n, edges: state.edges.map(e=>({u:e[0],v:e[1],w:e[2]})) };
  const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'graph_export.json'; a.click();
  URL.revokeObjectURL(url);
});

showAllBtn.addEventListener('click', ()=>{
  renderSVG(false);
});

highlightMSTBtn.addEventListener('click', ()=>{
  computeMSTAndRender();
});

/* Example data (same as the Python example provided) */
function loadExample(){
  state.n = 5;
  nodeCountInput.value = 5;
  state.edges = [
    [0,1,2,state.nextEdgeId++],
    [0,3,6,state.nextEdgeId++],
    [1,2,3,state.nextEdgeId++],
    [1,3,8,state.nextEdgeId++],
    [1,4,5,state.nextEdgeId++],
    [2,4,7,state.nextEdgeId++],
    [3,4,9,state.nextEdgeId++],
  ];
  state.mstResult = null;
  renderEdgesTable();
  renderSVG();
  mstCostEl.textContent = '—';
  mstListEl.textContent = '—';
}

/* initial load */
loadExample();
computeMSTAndRender();

</script>
</body>
</html>
